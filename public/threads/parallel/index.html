<!DOCTYPE html>
<html lang="fr-ca" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/420-410/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=420-410/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.142.0">
    <meta name="generator" content="Relearn 7.3.1+80e448e5bdaa92c87ee0d0d86f1125c8606ebf5f">
    <meta name="description" content="Dans les applications connectées, il est fréquent qu’un même programme doive gérer plusieurs processus simultanément. Cela peut poser des problèmes lorsqu’une tâche monopolise le processeur et que pendant ce temps, d’autres processus attendent leur tour.
Dans un programme ordinaire, les instructions sont exécutées en séquence:
long double pi; pi = calculerPiALaMillioniemeDecimale() printf(&#34;SVP Patientez&#34;); Dans cet exemple, le message “SVP Patientez” est assez inutile car l’instruction printf() ne s’exécutera pas tant que la fonction de la ligne précédente ne sera pas terminée.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Processus en parallèle :: Introduction aux plateformes IdO">
    <meta name="twitter:description" content="Dans les applications connectées, il est fréquent qu’un même programme doive gérer plusieurs processus simultanément. Cela peut poser des problèmes lorsqu’une tâche monopolise le processeur et que pendant ce temps, d’autres processus attendent leur tour.
Dans un programme ordinaire, les instructions sont exécutées en séquence:
long double pi; pi = calculerPiALaMillioniemeDecimale() printf(&#34;SVP Patientez&#34;); Dans cet exemple, le message “SVP Patientez” est assez inutile car l’instruction printf() ne s’exécutera pas tant que la fonction de la ligne précédente ne sera pas terminée.">
    <meta property="og:url" content="http://localhost:1313/420-410/threads/parallel/index.html">
    <meta property="og:site_name" content="Introduction aux plateformes IdO">
    <meta property="og:title" content="Processus en parallèle :: Introduction aux plateformes IdO">
    <meta property="og:description" content="Dans les applications connectées, il est fréquent qu’un même programme doive gérer plusieurs processus simultanément. Cela peut poser des problèmes lorsqu’une tâche monopolise le processeur et que pendant ce temps, d’autres processus attendent leur tour.
Dans un programme ordinaire, les instructions sont exécutées en séquence:
long double pi; pi = calculerPiALaMillioniemeDecimale() printf(&#34;SVP Patientez&#34;); Dans cet exemple, le message “SVP Patientez” est assez inutile car l’instruction printf() ne s’exécutera pas tant que la fonction de la ligne précédente ne sera pas terminée.">
    <meta property="og:locale" content="fr_ca">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Threads">
    <meta property="article:published_time" content="2024-02-11T19:56:53-05:00">
    <meta property="article:modified_time" content="2024-02-11T19:56:53-05:00">
    <meta itemprop="name" content="Processus en parallèle :: Introduction aux plateformes IdO">
    <meta itemprop="description" content="Dans les applications connectées, il est fréquent qu’un même programme doive gérer plusieurs processus simultanément. Cela peut poser des problèmes lorsqu’une tâche monopolise le processeur et que pendant ce temps, d’autres processus attendent leur tour.
Dans un programme ordinaire, les instructions sont exécutées en séquence:
long double pi; pi = calculerPiALaMillioniemeDecimale() printf(&#34;SVP Patientez&#34;); Dans cet exemple, le message “SVP Patientez” est assez inutile car l’instruction printf() ne s’exécutera pas tant que la fonction de la ligne précédente ne sera pas terminée.">
    <meta itemprop="datePublished" content="2024-02-11T19:56:53-05:00">
    <meta itemprop="dateModified" content="2024-02-11T19:56:53-05:00">
    <meta itemprop="wordCount" content="1666">
    <title>Processus en parallèle :: Introduction aux plateformes IdO</title><link rel="icon" href="/420-410/images/favicon.png" type="image/png">

    <link href="/420-410/css/fontawesome-all.min.css?1737563224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/420-410/css/fontawesome-all.min.css?1737563224" rel="stylesheet"></noscript>
    <link href="/420-410/css/auto-complete.css?1737563224" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/420-410/css/auto-complete.css?1737563224" rel="stylesheet"></noscript>
    <link href="/420-410/css/perfect-scrollbar.min.css?1737563224" rel="stylesheet">
    <link href="/420-410/css/theme.css?1737563224" rel="stylesheet">
    <link href="/420-410/css/format-html.css?1737563224" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313\/420-410';
      window.relearn.min = ``;
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      // variant stuff
      window.relearn.themevariants = [ 'green' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant");
        var select = document.querySelector("#R-select-variant");
        if (select) {
          select.value = variant;
        }
      }
      window.relearn.initVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support html disableInlineCopyToClipboard" data-url="/420-410/threads/parallel/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Threads</span><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Processus en parallèle</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable threads" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="processus-en-parallèle">Processus en parallèle</h1>

<p>Dans les applications connectées, il est fréquent qu&rsquo;un même programme doive gérer plusieurs processus simultanément. Cela peut poser des problèmes lorsqu&rsquo;une tâche monopolise le processeur et que pendant ce temps, d&rsquo;autres processus attendent leur tour.</p>
<p>Dans un programme ordinaire, les instructions sont exécutées en séquence:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">long</span> <span style="color:#66d9ef">double</span> pi;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pi <span style="color:#f92672">=</span> <span style="color:#a6e22e">calculerPiALaMillioniemeDecimale</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;SVP Patientez&#34;</span>);</span></span></code></pre></div>
<p>Dans cet exemple, le message &ldquo;SVP Patientez&rdquo; est assez inutile car l&rsquo;instruction <code>printf()</code> ne s&rsquo;exécutera pas tant que la fonction de la ligne précédente ne sera pas terminée.</p>
<p>Prenons un programme simple qui fait clignoter indéfiniment un module LED toutes les 250ms:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pigpio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define LED 17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Initialiser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">gpioInitialise</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fprintf</span>(stderr, <span style="color:#e6db74">&#34;Erreur d&#39;initialisation pigpio</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Définir en mode output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioSetMode</span>(LED, PI_OUTPUT);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Allumer 1 s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gpioWrite</span>(LED, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Éteindre 1 s
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">gpioWrite</span>(LED, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);  
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Libérer les ressources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioTerminate</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Comment peut-on modifier ce programme pour faire clignoter 2 modules LED, 1 chaque 250ms et l&rsquo;autre chaque 500ms?</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pigpio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Faire clignoter LED 1 chaque 250ms et LED 2 chaque 500ms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> LED1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">17</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> LED2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">24</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Initialiser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">gpioInitialise</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fprintf</span>(stderr, <span style="color:#e6db74">&#34;Erreur d&#39;initialisation pigpio</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Définir en mode output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioSetMode</span>(LED1, PI_OUTPUT);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gpioSetMode</span>(LED2, PI_OUTPUT);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED2, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED2, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Libérer les ressources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioTerminate</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>On voit immédiatement que cette solution n&rsquo;est pas idéale car la structure de notre programme dépend des données. Si en effet on veut changer les durées, par exemple 1 LED qui clignote chaque 300ms et l&rsquo;autre chaque 700ms, il faudra revoir tout ce que contient la boucle <code>while</code>.</p>
<p>Intuitivement on voit qu&rsquo;il serait préférable d&rsquo;avoir deux boucles et que chacune définit sa propre durée. Le programme suivant est mieux construit:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pigpio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LED1 17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LED2 24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">clignoter1</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">clignoter2</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED2, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">500000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED2, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">500000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Faire clignoter LED 1 chaque 250ms et LED 2 chaque 500ms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Initialiser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">gpioInitialise</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fprintf</span>(stderr, <span style="color:#e6db74">&#34;Erreur d&#39;initialisation pigpio</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Définir en mode output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioSetMode</span>(LED1, PI_OUTPUT);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gpioSetMode</span>(LED2, PI_OUTPUT);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">clignoter1</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">clignoter2</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Libérer les ressources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioTerminate</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Chacune des deux boucles est définie dans sa propre fonction, et même si il y a plusieurs répétitions, le programme est mieux structuré. Par contre il ne donne pas le résultat escompté car les deux fonctions vont s&rsquo;éxécuter une après l&rsquo;autre.</p>
<h2 id="_threads_"><em>Threads</em></h2>
<p>En programmation, il est possible de créer des nouveaux processus plus ou moins indépendants du flot normal d&rsquo;exécution du programme principal. On nomme ces processus &ldquo;threads&rdquo;.</p>
<p>Lorsqu&rsquo;on crée un thread, on lui associe une fonction. Cette fonction sera exécutée dans son propre processus et ainsi ne bloquera pas le processus principal.</p>
<p>Dans l&rsquo;exemple suivant, on utilise la fonction <code>pthread_create()</code> pour lancer les fonctions &ldquo;clignoter&rdquo; dans leurs propres processus:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pigpio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pthread.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LED1 17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LED2 24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">clignoter1</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED1, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">250000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">clignoter2</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED2, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">500000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(LED2, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">500000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Faire clignoter LED 1 chaque 250ms et LED 2 chaque 500ms
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Initialiser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">gpioInitialise</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fprintf</span>(stderr, <span style="color:#e6db74">&#34;Erreur d&#39;initialisation pigpio</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Définir en mode output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioSetMode</span>(LED1, PI_OUTPUT);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">gpioSetMode</span>(LED2, PI_OUTPUT);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Créer les threads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">pthread_t</span> t_led1,t_led2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pthread_create</span>(<span style="color:#f92672">&amp;</span>t_led1,NULL,clignoter1,NULL) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Erreur à la création du thread pour LED 1.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pthread_create</span>(<span style="color:#f92672">&amp;</span>t_led2,NULL,clignoter2,NULL) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Erreur à la création du thread pour LED 2.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Attendre la fin de l&#39;exécution de chaque thread
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">pthread_join</span>(t_led1, NULL);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Fin du thread 1.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pthread_join</span>(t_led2, NULL);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Fin du thread 2.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Libérer les ressources
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioTerminate</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Les modifications apportées au code:</p>
<ul>
<li>Ajouté <code>#include &lt;pthread.h&gt;</code></li>
<li>Les fonctions sont déclarées comme des pointeurs</li>
<li>Des variables de type <code>pthread_t</code> réfèrent aux threads créés</li>
<li>La fonction <code>pthread_create()</code> crée les threads</li>
<li>La fonction <code>pthread_join()</code> attend que les threads se terminent</li>
</ul>
<blockquote>
<p>ATTENTION: Au moment de la compilation, il faut ajouter l&rsquo;option <code>-lpthread</code> à la commande <strong>gcc</strong>.</p>
</blockquote>
<h5 id="pthread_create"><code>pthread_create()</code></h5>
<p>Sert à créer un <em>thread</em>, le mettre dans une variable et l&rsquo;associer à une fonction donnée. Dans le programme cette fonction a 4 paramètres:</p>
<ul>
<li><code>&amp;t_led1</code> : La référence au thread créé</li>
<li><code>NULL</code> : Les attributs qu&rsquo;on veut lui donner (par exemple sa priorité, la taille de la mémoire allouée, etc.). Si NULL, le thread aura des valeurs par défaut.</li>
<li><code>clignoter</code> : Le nom de la fonction que le processus doit appeler. Attention, il n&rsquo;y a pas les parenthèses: on donne le nom seulement.</li>
<li><code>NULL</code> : Un pointeur vers les arguments de la fonction s&rsquo;il y en a.</li>
</ul>
<h5 id="pthread_join"><code>pthread_join()</code></h5>
<p>Attend la fin de l&rsquo;exécution du processus et revient au programme principal. Dans l&rsquo;exemple, comme on a des boucles infinies on n&rsquo;y arrivera jamais.</p>
<ul>
<li><code>t_led1</code> : La référence au thread créé</li>
<li><code>NULL</code> : Une variable qui contiendra la valeur retournée par la fonction.</li>
</ul>

<details open class=" box cstyle notices primary">
  <summary class="box-label" tabindex="-1">
    Pause pour le prof
  </summary>
  <div class="box-content">
<ol>
<li>Modifier les fonctions pour que les LED clignotent 10 fois seulement.</li>
<li>Comment changer la boucle FOR des fonctions pour que le thread 2 termine avant le premier?</li>
</ol>
  </div>
</details>
<h4 id="passage-de-paramètres">Passage de paramètres</h4>
<p>On aurait un meilleur programme si on avait une seule fonction <code>clignoter()</code> à laquelle on passerait toutes les variables:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// &#39;ms&#39; est le nombre de millisecondes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// &#39;gpio&#39; est le numéro de broche GPIO
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">clignoter</span>(<span style="color:#66d9ef">int</span> ms, <span style="color:#66d9ef">int</span> gpio) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">15</span>;i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(gpio, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(ms<span style="color:#f92672">*</span><span style="color:#ae81ff">000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(gpio, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(ms<span style="color:#f92672">*</span><span style="color:#ae81ff">000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Mais la fonction passée à <code>pthread_create()</code> ne peut pas avoir plusieurs arguments: elle n&rsquo;a droit qu&rsquo;à un seul. Celui-ci peut cependant être un pointeur, donc on peut passer à la fonction un tableau (ou une <a href="https://www.w3schools.com/c/c_structs.php" rel="external" target="_blank">struct</a>) qui contient autant d&rsquo;éléments qu&rsquo;on veut, simplement en passant un pointeur sur ce tableau.</p>
<p>On réécrira donc la fonction pour que la variable passée soit un tableau de deux éléments; le premier est le nombre de millisecondes, et le deuxième est le numéro de GPIO:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">clignoter</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>args) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">15</span>;i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(args[<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(args[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(args[<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(args[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Il faut aussi modifier la partie du programme où on crée les threads:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>    <span style="color:#66d9ef">pthread_t</span> t_led1,t_led2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> arg1[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">250</span>,LED1};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> arg2[] <span style="color:#f92672">=</span> {<span style="color:#ae81ff">500</span>,LED2};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pthread_create</span>(<span style="color:#f92672">&amp;</span>t_led1,NULL,clignoter,<span style="color:#f92672">&amp;</span>arg1) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Erreur à la création du thread pour LED 1.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pthread_create</span>(<span style="color:#f92672">&amp;</span>t_led2,NULL,clignoter,<span style="color:#f92672">&amp;</span>arg2) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;Erreur à la création du thread pour LED 2.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }</span></span></code></pre></div>
<p>Si on compile ce programme on aura une erreur. Pourquoi?</p>
<p>La raison est la suivante: afin que la fonction passée à <code>pthread_create()</code> ne soit pas limitée dans les types d&rsquo;arguments qu&rsquo;elle peut avoir, le 4e paramètre (<code>&amp;arg1</code> et <code>&amp;arg2</code> dans l&rsquo;exemple) sera passé à la fonction comme un pointeur de type <code>void *</code>. Puisque dans notre cas elle est définie avec un argument <code>int *</code>, on a une erreur.</p>
<p>La version qui fonctionne:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">clignoter</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>args) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>valeurs <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>)args;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> ms <span style="color:#f92672">=</span> valeurs[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> gpio <span style="color:#f92672">=</span> valeurs[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>;i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">10</span>;i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(gpio, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(ms<span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(gpio, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(ms<span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div>
<p>On crée un tableau d&rsquo;entiers, par exemple <code>arg1[]</code>, mais ce tableau &ldquo;perd&rdquo; en quelque sorte son type lorsqu&rsquo;il est passé à la fonction <code>pthread_create()</code>. Il est ensuite passé à <code>clignoter()</code> comme un pointeur <em>void</em>, et on lui redonne le type <code>int *</code> pour accéder aux valeurs qu&rsquo;il contient.</p>
<blockquote>
<p><code>pthread_create()</code> travaille uniquement avec des <strong>adresses</strong>: celles de la fonction qu&rsquo;elle doit appeler (c&rsquo;est pourquoi <code>*clignoter()</code> est déclarée avec <code>*</code>) et celle d&rsquo;un pointeur <em>void</em> qui indique où se trouvent les arguments à passer à cette fonction. C&rsquo;est à nous de s&rsquo;assurer qu&rsquo;on redonne ensuite le bon type à ce pointeur: si un pointeur a un type <em>void</em>, le compilateur ne sait pas quelle taille la variable occupe en mémoire et donc est incapable de lire sa valeur, de se déplacer à la prochaine valeur, etc.</p>
</blockquote>
<h4 id="exercice-1">Exercice 1</h4>
<p>Pour l&rsquo;instant dans notre fonction les LED clignotent 10 fois. Modifier le programme pour que le nombre de clignotements soit le 3e argument passé à la fonction.</p>
<h4 id="exercice-2">Exercice 2</h4>
<p>Changez la fonction pour que les LED clignotent toujours 10 fois à 100 ms d&rsquo;intervalle, avec ces valeurs codées directement dans la fonction. La seule chose qu&rsquo;il faut passer à <code>clignoter()</code> est donc un <code>int</code> qui désigne le GPIO. Refaites le programme pour que les variables <code>arg1</code> et <code>arg2</code> soient des nombres entiers.</p>
<h4 id="exercice-3">Exercice 3</h4>
<p>On se base sur l&rsquo;exercice du chapitre précédent:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pthread.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/socket.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;netinet/in.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;pigpio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#define BUFFER_SIZE 10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define LED_PIN 17
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#define PORT 8888
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Modifier cette fonction pour qu&#39;elle puisse être passée à pthread_create()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">clignoter</span>(<span style="color:#66d9ef">int</span> gpio) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (;;) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(gpio, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gpioWrite</span>(gpio, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">usleep</span>(<span style="color:#ae81ff">100000</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> socket_local;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> sockaddr_in adr_local, adr_dist;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> buffer[BUFFER_SIZE];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Créer le socket et initialiser l&#39;adresse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    socket_local <span style="color:#f92672">=</span> <span style="color:#a6e22e">socket</span>(AF_INET, SOCK_DGRAM, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">memset</span>(<span style="color:#f92672">&amp;</span>adr_local, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(adr_local));
</span></span><span style="display:flex;"><span>    adr_local.sin_family <span style="color:#f92672">=</span> AF_INET; 
</span></span><span style="display:flex;"><span>    adr_local.sin_addr.s_addr <span style="color:#f92672">=</span> INADDR_ANY;
</span></span><span style="display:flex;"><span>    adr_local.sin_port <span style="color:#f92672">=</span> <span style="color:#a6e22e">htons</span>(PORT);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Associer le socket à l&#39;adresse de l&#39;interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">bind</span>(socket_local, (<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> sockaddr <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>adr_local, <span style="color:#66d9ef">sizeof</span>(adr_local));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Preparation de pigpio
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Initialiser
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">gpioInitialise</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fprintf</span>(stderr, <span style="color:#e6db74">&#34;Failed to initialize pigpio</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Définir en mode output
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">gpioSetMode</span>(LED_PIN, PI_OUTPUT);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Réception des messages  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> input[BUFFER_SIZE];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> len,n;
</span></span><span style="display:flex;"><span>        len <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(adr_dist); 
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Stocker le message reçu dans n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        n <span style="color:#f92672">=</span> <span style="color:#a6e22e">recvfrom</span>(socket_local, (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>)buffer, BUFFER_SIZE, MSG_WAITALL, (<span style="color:#66d9ef">struct</span> sockaddr <span style="color:#f92672">*</span>)<span style="color:#f92672">&amp;</span>adr_dist, <span style="color:#f92672">&amp;</span>len);
</span></span><span style="display:flex;"><span>        buffer[n] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Voir quel mot a été reçu
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(buffer, <span style="color:#e6db74">&#34;allume</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gpioWrite</span>(LED_PIN, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(buffer,<span style="color:#e6db74">&#34;ferme</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gpioWrite</span>(LED_PIN, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(buffer,<span style="color:#e6db74">&#34;exit</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gpioWrite</span>(LED_PIN, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">gpioTerminate</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">strcmp</span>(buffer,<span style="color:#e6db74">&#34;flash</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Créer ici le thread qui lance la fonction clignoter
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Ajoutez à ce programme une commande &ldquo;flash&rdquo; qui aura pour effet de faire clignoter la LED en créant un thread.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<svg width="255" height="68.003" viewBox="0 0 350 68.003" xmlns="http://www.w3.org/2000/svg"><g id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#ffffff" stroke-width="0.25mm" fill="#ffffff" style="stroke:#ffffff;stroke-width:0.25mm;fill:#ffffff"><path d="M 100.4 67.002 L 56.6 67.002 L 56.6 65.602 Q 65.5 58.202 72.7 52.002 A 220.885 220.885 0 0 0 79.022 46.354 Q 81.944 43.635 84.444 41.079 A 132.81 132.81 0 0 0 85.15 40.352 Q 89.831 35.492 92.564 30.912 A 35.666 35.666 0 0 0 93.2 29.802 Q 96 24.702 96 19.502 A 23.026 23.026 0 0 0 95.376 13.982 A 15.644 15.644 0 0 0 90.95 6.202 Q 85.9 1.402 77.2 1.402 A 23.25 23.25 0 0 0 70.975 2.193 A 17.307 17.307 0 0 0 63.1 6.802 A 19.378 19.378 0 0 0 58.069 16.175 A 27.398 27.398 0 0 0 57.4 21.202 L 55.9 20.602 A 27.734 27.734 0 0 1 56.698 15.069 A 21.147 21.147 0 0 1 58.85 9.702 Q 61.5 5.102 66.2 2.552 A 20.811 20.811 0 0 1 72.968 0.317 A 27.399 27.399 0 0 1 77.2 0.002 A 29.218 29.218 0 0 1 81.794 0.347 A 22.6 22.6 0 0 1 85.65 1.302 A 17.842 17.842 0 0 1 90.38 3.748 A 16.244 16.244 0 0 1 92.05 5.152 Q 94.7 7.702 96.1 11.302 A 20.224 20.224 0 0 1 97.269 15.929 A 26.583 26.583 0 0 1 97.5 19.502 A 23.288 23.288 0 0 1 94.81 30.249 A 30.041 30.041 0 0 1 92.9 33.452 Q 88.3 40.202 79.75 47.852 Q 73.872 53.111 66.41 59.481 A 1196.423 1196.423 0 0 1 59.3 65.502 L 59.3 65.602 L 60.25 65.602 L 61.2 65.602 L 62.1 65.602 L 100.4 65.602 L 100.4 67.002 Z M 35 67.002 L 33.4 67.002 L 33.4 46.502 L 0 46.502 L 0 45.102 L 32.8 1.002 L 35 1.002 L 35 45.102 L 48.9 45.102 L 48.9 46.502 L 35 46.502 L 35 67.002 Z M 244.1 67.002 L 242.5 67.002 L 242.5 46.502 L 209.1 46.502 L 209.1 45.102 L 241.9 1.002 L 244.1 1.002 L 244.1 45.102 L 258 45.102 L 258 46.502 L 244.1 46.502 L 244.1 67.002 Z M 134.1 68.002 Q 122.8 68.002 116.7 59.202 A 29.95 29.95 0 0 1 112.765 50.844 Q 111.549 46.872 111.016 42.051 A 73.401 73.401 0 0 1 110.6 34.002 Q 110.6 23.331 113.182 15.878 A 29.029 29.029 0 0 1 116.7 8.802 Q 122.8 0.002 134.1 0.002 Q 145.4 0.002 151.5 8.802 A 29.95 29.95 0 0 1 155.435 17.16 Q 156.651 21.131 157.184 25.953 A 73.401 73.401 0 0 1 157.6 34.002 Q 157.6 44.672 155.018 52.125 A 29.029 29.029 0 0 1 151.5 59.202 Q 145.4 68.002 134.1 68.002 Z M 321.4 68.002 Q 310.1 68.002 304 59.202 A 29.95 29.95 0 0 1 300.065 50.844 Q 298.849 46.872 298.316 42.051 A 73.401 73.401 0 0 1 297.9 34.002 Q 297.9 23.331 300.482 15.878 A 29.029 29.029 0 0 1 304 8.802 Q 310.1 0.002 321.4 0.002 Q 332.7 0.002 338.8 8.802 A 29.95 29.95 0 0 1 342.735 17.16 Q 343.951 21.131 344.484 25.953 A 73.401 73.401 0 0 1 344.9 34.002 Q 344.9 44.672 342.318 52.125 A 29.029 29.029 0 0 1 338.8 59.202 Q 332.7 68.002 321.4 68.002 Z M 282.7 67.002 L 281.1 67.002 L 281.1 10.202 L 281.1 7.102 L 281.1 4.002 Q 278.1 8.902 273.35 12.152 A 39.094 39.094 0 0 1 266.547 15.906 A 34.337 34.337 0 0 1 263.6 17.002 L 263.1 15.702 Q 265.8 14.702 268.45 13.302 Q 271.1 11.902 273.5 10.052 Q 275.9 8.202 277.85 5.952 Q 279.8 3.702 281.1 1.002 L 282.7 1.002 L 282.7 67.002 Z M 134.1 66.602 A 22.253 22.253 0 0 0 139.882 65.884 A 17.301 17.301 0 0 0 146.05 62.852 A 19.885 19.885 0 0 0 150.779 57.51 Q 152.334 54.995 153.45 51.802 A 41.889 41.889 0 0 0 155.193 44.802 Q 155.773 41.284 155.936 37.244 A 80.409 80.409 0 0 0 156 34.002 Q 156 23.402 153.45 16.152 Q 150.9 8.902 146.05 5.152 Q 141.2 1.402 134.1 1.402 A 21.727 21.727 0 0 0 128.093 2.198 A 17.569 17.569 0 0 0 122.2 5.152 A 20.005 20.005 0 0 0 117.32 10.657 Q 115.919 12.941 114.886 15.772 A 34.522 34.522 0 0 0 114.75 16.152 Q 112.664 22.084 112.284 30.258 A 80.802 80.802 0 0 0 112.2 34.002 A 72.19 72.19 0 0 0 112.589 41.716 Q 113.006 45.592 113.871 48.905 A 37.497 37.497 0 0 0 114.75 51.802 A 29.135 29.135 0 0 0 117.155 57.055 Q 119.252 60.596 122.2 62.852 A 18.121 18.121 0 0 0 131.112 66.419 A 23.774 23.774 0 0 0 134.1 66.602 Z M 321.4 66.602 A 22.253 22.253 0 0 0 327.182 65.884 A 17.301 17.301 0 0 0 333.35 62.852 A 19.885 19.885 0 0 0 338.079 57.51 Q 339.634 54.995 340.75 51.802 A 41.889 41.889 0 0 0 342.493 44.802 Q 343.073 41.284 343.236 37.244 A 80.409 80.409 0 0 0 343.3 34.002 Q 343.3 23.402 340.75 16.152 Q 338.2 8.902 333.35 5.152 Q 328.5 1.402 321.4 1.402 A 21.727 21.727 0 0 0 315.393 2.198 A 17.569 17.569 0 0 0 309.5 5.152 A 20.005 20.005 0 0 0 304.62 10.657 Q 303.219 12.941 302.186 15.772 A 34.522 34.522 0 0 0 302.05 16.152 Q 299.964 22.084 299.584 30.258 A 80.802 80.802 0 0 0 299.5 34.002 A 72.19 72.19 0 0 0 299.889 41.716 Q 300.306 45.592 301.171 48.905 A 37.497 37.497 0 0 0 302.05 51.802 A 29.135 29.135 0 0 0 304.455 57.055 Q 306.552 60.596 309.5 62.852 A 18.121 18.121 0 0 0 318.412 66.419 A 23.774 23.774 0 0 0 321.4 66.602 Z M 1.8 45.102 L 33.4 45.102 L 33.4 8.802 L 33.4 5.752 L 33.4 2.702 L 33.3 2.702 Q 32.3 4.202 31.15 5.702 A 110.715 110.715 0 0 0 29.509 7.895 A 96.037 96.037 0 0 0 29 8.602 L 1.8 45.102 Z M 210.9 45.102 L 242.5 45.102 L 242.5 8.802 L 242.5 5.752 L 242.5 2.702 L 242.4 2.702 Q 241.4 4.202 240.25 5.702 A 110.715 110.715 0 0 0 238.609 7.895 A 96.037 96.037 0 0 0 238.1 8.602 L 210.9 45.102 Z M 170.4 39.202 L 198.5 39.202 L 198.5 40.802 L 170.4 40.802 L 170.4 39.202 Z" vector-effect="non-scaling-stroke"/></g></svg>

        </div>
        <script>
          window.index_js_url="/420-410/searchindex.en.js?1737563224";
        </script>
        <search><form action="/420-410/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
        <script>
          var contentLangs=['fr'];
        </script>
        <script src="/420-410/js/auto-complete.js?1737563224" defer></script>
        <script src="/420-410/js/lunr/lunr.min.js?1737563224" defer></script>
        <script src="/420-410/js/lunr/lunr.stemmer.support.min.js?1737563224" defer></script>
        <script src="/420-410/js/lunr/lunr.multi.min.js?1737563224" defer></script>
        <script src="/420-410/js/lunr/lunr.fr.min.js?1737563224" defer></script>
        <script src="/420-410/js/search.js?1737563224" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation">
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-shortcutmenu-home" class="R-sidebarmenu">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/420-410/pr%C3%A9paration/index.html"><a class="padding" href="/420-410/pr%C3%A9paration/index.html">1. Préparation</a><ul id="R-subsections-481e5bcc4180197d50b8ef2fafbb3420" class="collapsible-menu"></ul></li>
          </ul>
        </div>
    
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-language"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = this.querySelector( this.value ).dataset.url;">
                      <option id="R-select-language-en" value="#R-select-language-en" data-url="/420-410/threads/parallel/index.html" lang="fr-ca" selected></option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-paint-brush"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.relearn.changeVariant( this.value );">
                      <option id="R-select-variant-green" value="green" selected>Green</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.relearn.markVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-history"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Licence Creative Commons"
        style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a><br>Creative Commons
BY-NC-SA
          </div>
        </div>
      </div>
    </aside>
    <script src="/420-410/js/clipboard.min.js?1737563224" defer></script>
    <script src="/420-410/js/perfect-scrollbar.min.js?1737563224" defer></script>
    <script src="/420-410/js/theme.js?1737563224" defer></script>
  </body>
</html>
